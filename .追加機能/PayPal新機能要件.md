以下は、これまでの情報を基に、IRU TOMOのPayPal支払い機能（特にプライシングプランに関して）を中心に、機能一覧・優先度リスト（Backlog）をPlantUMLで視覚化し、わかりやすく構造化・清書した資料です。現在の日付（2025年2月27日）を踏まえ、韓国人MZ世代向けのMVPフェーズ（React、Supabase、PayPal統合）を考慮して、機能の優先度（MoSCoW法）とストーリーポイント（工数見積もり）を詳細に記述します。

---

## 2-1. 機能一覧・優先度リスト (Backlog)

### 1. 機能の優先度分類（MoSCoW法）
IRU TOMOのPayPal支払い機能および関連機能を、必須（Must）、重要（Should）、オプション（Could）、対象外（Won't）に分類します。プライシングプラン（人数に基づく支払い金額：1〜4人：1,000 JPY、5〜8人：2,000 JPY、9〜12人：3,000 JPY）を中心に設計します。

#### 1.1 Must (必須)
これらの機能は、MVPフェーズで必ず実装が必要です。韓国人MZ世代のユーザー体験を確保し、基本的な支払いプロセスをサポート。

- **PayPal支払い機能の基本実装**:
  - 説明: ユーザーがPayPalを通じて予約手数料を支払える機能（初期値：1,000 JPY）。
  - プライシングプラン: 人数選択（`party_size`）に基づく動的金額計算。
    - 1〜4人：1,000 JPY
    - 5〜8人：2,000 JPY
    - 9〜12人：3,000 JPY
  - ストーリーポイント: 5（フロントエンドとバックエンドの統合、APIコール、UI実装が必要）。
  - 理由: 韓国人旅行者の予約プロセスを簡便化し、基本的な収益源として不可欠。

- **予約入力項目の追加**:
  - 説明: 予約時の入力項目に名前（`name`）、電話番号（`phone`）、メールアドレス（`email`）を追加。
  - ストーリーポイント: 3（フォームのUI/UX設計、バリデーション、データベース保存）。
  - 理由: ユーザー識別と連絡先確認が必須。

- **支払い完了後の自動メール送信**:
  - 説明: 支払い完了後に多言語（日本語、英語、韓国語）で予約確認メールを送信（`nodemailer`＋SMTP）。
  - ストーリーポイント: 4（メールテンプレート作成、言語切り替えロジック、送信失敗時のエラー処理）。
  - 理由: ユーザーへの安心感と信頼性向上。

- **支払いステータスの保存**:
  - 説明: `reservations`と`payments`テーブルに`payment_status`（'pending'、'completed'、'failed'）と`transaction_id`を保存。
  - ストーリーポイント: 3（Supabaseクエリ、データモデルの更新）。
  - 理由: 支払い履歴の管理とトラブルシューティングが必須。

#### 1.2 Should (重要)
これらの機能は、MVPで実装できれば有用だが、必須ではない。初期リリース後に優先的に対応。

- **支払い失敗時の再試行機能**:
  - 説明: PayPal支払い失敗時にユーザーに再試行を促すインターフェースを提供（最大3回）。
  - ストーリーポイント: 4（エラー処理、UIデザイン、バックエンドロジック）。
  - 理由: ユーザー体験の向上とコンバージョン率の維持。

- **リアルタイム金額プレビュー**:
  - 説明: 人数選択時にPayPalボタンの金額がリアルタイムで更新（例: 「1,000 JPYで支払う」）。
  - ストーリーポイント: 3（Reactの状態管理、UI更新）。
  - 理由: 透明性とユーザーの意思決定をサポート。

- **多通貨対応（将来）**:
  - 説明: PayPalを通じて韓国ウォン（KRW）や米ドル（USD）での支払いオプションを提供（初期はJPYのみ）。
  - ストーリーポイント: 5（PayPal API拡張、通貨変換ロジック）。
  - 理由: 韓国人ユーザーの利便性向上。

#### 1.3 Could (オプション)
これらの機能は、余裕があれば実装し、将来的な拡張として検討。

- **支払い履歴のユーザー閲覧**:
  - 説明: ユーザーが自身の予約と支払い履歴をダッシュボードで確認可能（`reservations`と`payments`の統合）。
  - ストーリーポイント: 5（UIデザイン、API統合、セキュリティ）。
  - 理由: ユーザー体験の強化。

- **クーポンや割引コードの適用**:
  - 説明: 支払い時にクーポンコードを入力し、金額を割引（例: 10%オフ）。
  - ストーリーポイント: 6（バックエンドロジック、UI、データベース拡張）。
  - 理由: マーケティング戦略の強化。

- **SMS通知オプション**:
  - 説明: 支払い完了や予約確認をSMSで送信（初期はメールのみ）。
  - ストーリーポイント: 4（Twilio API統合、コスト管理）。
  - 理由: 追加の通知チャネル。

#### 1.4 Won't (対象外)
現時点では実装しない機能。将来の拡張として検討。

- **クレジットカード直接支払い**:
  - 説明: PayPal以外の支払い方法（Stripeや直接クレジットカード入力）。
  - 理由: MVPではPayPalに限定し、コストと複雑さを最小限に。
  - ストーリーポイント: N/A（対象外）。

- **物理的な支払い（現金）**:
  - 説明: 店舗での現金支払いオプション。
  - 理由: オンライン予約サービスに非対応。
  - ストーリーポイント: N/A（対象外）。

- **AIによる価格最適化**:
  - 説明: 人数や時間帯に基づく動的価格設定。
  - 理由: MVPでは固定価格（人数ベース）で十分。
  - ストーリーポイント: N/A（対象外）。

### 2. ストーリーポイント（工数見積もり）
各機能の開発工数を以下のように見積もります。ストーリーポイントは、チームの経験やタスクの複雑さを基に1〜10のスケールで評価（1: 簡単、5: 中程度、10: 非常に複雑）。

| 機能名                                      | 優先度   | ストーリーポイント | 備考                                                                 |
|---------------------------------------------|----------|-------------------|----------------------------------------------------------------------|
| PayPal支払い機能の基本実装                  | Must     | 5                 | フロントエンドUI、バックエンドAPI、PayPal統合                        |
| 予約入力項目の追加（名前、電話番号）         | Must     | 3                 | フォーム設計、バリデーション、データベース保存                       |
| 支払い完了後の自動メール送信                 | Must     | 4                 | メールテンプレート、多言語対応、エラー処理                           |
| 支払いステータスの保存                      | Must     | 3                 | Supabaseクエリ、データモデル更新                                    |
| 支払い失敗時の再試行機能                    | Should   | 4                 | エラー処理、UIデザイン、バックエンドロジック                         |
| リアルタイム金額プレビュー                   | Should   | 3                 | React状態管理、UI更新                                               |
| 多通貨対応（将来）                          | Should   | 5                 | PayPal API拡張、通貨変換ロジック                                     |
| 支払い履歴のユーザー閲覧                    | Could    | 5                 | UIデザイン、API統合、セキュリティ                                    |
| クーポンや割引コードの適用                  | Could    | 6                 | バックエンドロジック、UI、データベース拡張                           |
| SMS通知オプション                           | Could    | 4                 | Twilio API統合、コスト管理                                          |
| クレジットカード直接支払い                  | Won't    | N/A               | MVPではPayPalに限定                                                 |
| 物理的な支払い（現金）                      | Won't    | N/A               | オンライン予約サービスに非対応                                       |
| AIによる価格最適化                         | Won't    | N/A               | MVPでは固定価格（人数ベース）で十分                                  |

### 3. PlantUMLによる優先度リストの視覚化
Backlogの優先度をPlantUMLで表現し、機能の優先度と工数を視覚的に整理します。

```plantuml
@startuml IRU TOMO Backlog 優先度リスト

' スキン設定
skinparam backgroundColor white
skinparam borderColor #FF8C00
skinparam defaultFontSize 14
skinparam defaultFontName "Noto Sans"

' コンテナ
package "Must (必須)" #LightGreen {
  note right
    必須機能：MVPで必ず実装
    韓国人MZ世代の基本体験を確保
  end note
  rectangle "PayPal支払い機能の基本実装\n(5 SP)" as M1
  rectangle "予約入力項目の追加\n(3 SP)" as M2
  rectangle "支払い完了後の自動メール送信\n(4 SP)" as M3
  rectangle "支払いステータスの保存\n(3 SP)" as M4
}

package "Should (重要)" #LightYellow {
  note right
    重要機能：MVP後に優先実装
    ユーザー体験の向上
  end note
  rectangle "支払い失敗時の再試行機能\n(4 SP)" as S1
  rectangle "リアルタイム金額プレビュー\n(3 SP)" as S2
  rectangle "多通貨対応（将来）\n(5 SP)" as S3
}

package "Could (オプション)" #LightBlue {
  note right
    オプション機能：余裕があれば実装
    将来的な拡張
  end note
  rectangle "支払い履歴のユーザー閲覧\n(5 SP)" as C1
  rectangle "クーポンや割引コードの適用\n(6 SP)" as C2
  rectangle "SMS通知オプション\n(4 SP)" as C3
}

package "Won't (対象外)" #LightGray {
  note right
    対象外機能：現時点では実装しない
    コストや複雑さを避ける
  end note
  rectangle "クレジットカード直接支払い" as W1
  rectangle "物理的な支払い（現金）" as W2
  rectangle "AIによる価格最適化" as W3
}

' 関係性
M1 .> M2 : 依存（予約入力後に支払い）
M2 .> M3 : 依存（入力完了後にメール送信）
M3 .> M4 : 依存（支払いステータス保存）

S1 .> M1 : 拡張（支払い失敗時の改善）
S2 .> M1 : 拡張（リアルタイムプレビュー）
S3 .> M1 : 拡張（多通貨対応）

C1 .> M4 : 依存（支払い履歴閲覧）
C2 .> M1 : 拡張（割引適用）
C3 .> M3 : 拡張（SMS通知）

@enduml
```

### 4. 補足
- **プライシングプランの詳細**:
  - 人数（`party_size`）に基づく動的金額計算は、IRU TOMOの収益モデルとして核心的なため、Must（必須）として位置付け。
  - 1〜4人：1,000 JPY、5〜8人：2,000 JPY、9〜12人：3,000 JPYを基に、フロントエンド（React）、バックエンド（Supabase Functions）、PayPal APIで実装。

- **工数見積もりの根拠**:
  - ストーリーポイントは、チームの経験（React/Supabase開発者2名、デザイナー1名）を基に、1 SP = 2〜4時間程度で算出。
  - Must機能は合計15 SP（約30〜60時間）、Should機能は12 SP（約24〜48時間）、Could機能は15 SP（約30〜60時間）。

- **MVPフェーズの考慮**:
  - 初期は手動運用（スタッフがSupabaseで支払いステータスを確認）。
  - 無料プラン（Supabase、PayPal Sandbox、SendGrid/Gmail無料プラン）で対応可能。

- **多言語対応**:
  - 機能名やエラーメッセージは、日本語、英語、韓国語で提供（`language_preference`に基づく）。

このBacklogは、IRU TOMOのMVP開発を効率的に進めるための優先順位と工数を明確化し、プライシングプランの実装を強化します。追加の質問や調整が必要な場合は、お知らせください！